#!/bin/sh

#comprobar actualizaciones

[ -z "$1" ] && opcion="$(cat << EOF | fzf
instalar paquete deb
ver repositorios
construir paquete debian
limpiar
limpiar
eliminar paquete debian instalado localmente
purgar paquete debian instalado localmnete
listar paquetes debian instalados localmente
comprobar
ver archivos de un paquete deb
purgar paquetes
instalar deb forzando
EOF
)"

case $opcion in
	"ver repositorios") grep -h '^#*[ ]*deb' /etc/apt/sources.list.d/* ; exit;;
	"construir paquete debian") dpkg-deb --build hello_1.0-1 ;;
	"ver archivos de un paquete deb") dpkg-deb -c "$(find . -maxdepth 1 | fzf)" ; exit;;
	"limpiar") sudo apt-get clean ; exit;;
	"limpiar") sudo apt-get autoclean ; exit;;
	"comprobar") sudo apt-get check ; exit;;
	"eliminar paquete debian instalado localmente") lista="$(dpkg --get-selections | awk '/deinstall/ {print $1}' | fzf)" \
		&& echo "$lista" && exit && sudo dpkg -r $lista ; exit;;
	"purgar paquetes debian instalados localmente") sudo dpkg -P $2 ; exit;;
	"listar paquetes debian instalados localmente") apt list --installed 2>/dev/null | grep ', local' ; exit;;
	"purgar paquetes") purga=$(dpkg --get-selections | awk '/deinstall/ {print $1}') \
		&& echo $purga && [ "$(echo 's\nn' | dmenu -p 'quieres purgar? ' )" = 's' ] \
		&& sudo apt purge $purga && exit || exit;;
	"instlar deb forzando") dpkg --force-architecture -i $1 ;; #forzar instalacion con arquitectura ajena
	"instalar paquete deb") archivo="$(find . -maxdepth 1 | fzf)" && dpkg -I "$archivo" && [ "$(printf 's\nn' | dmenu -p 'queres instalalo? ' )" = 's' ] \
	&& (sudo dpkg -i "$archivo" || sudo apt-get install -f) ;;
esac && exit

case $1 in
	-i) sudo apt install $1 ;;
	-u) sudo apt autoremove $1 ;;
	-f) dpkg-deb -c "$2" ; exit;;
	-p) purga=$(dpkg --get-selections | awk '/deinstall/ {print $1}') \
		&& echo $purga && [ "$(echo 's\nn' | dmenu -p 'quieres purgar? ' )" = 's' ] \
		&& sudo apt purge $purga && exit || exit;;
esac

#apt-cache policy | sed -n 's/.*o=\([^,]\+\).*/\1/p' | uniq
