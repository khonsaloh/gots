#!/bin/sh

#comprobar actualizaciones

[ -z "$1" ] && opcion="$(cat << EOF | fzf
instalar paquete deb
ver repositorios
construir paquete debian
limpiar
limpiar
eliminar paquete debian instalado localmente
purgar paquete debian instalado localmnete
listar paquetes debian instalados localmente
comprobar
ver archivos de un paquete deb
purgar paquetes
instalar deb forzando
ver versiones displonibles de un paquete
reinstalar paquete
EOF
)"

case $opcion in
	"ver repositorios") grep -s -h '^#*[ ]*deb' /etc/apt/sources.list.d/* ; exit;;
	"construir paquete debian") dpkg-deb --build hello_1.0-1 ;;
	"ver archivos de un paquete deb") dpkg-deb -c "$(find . -maxdepth 1 | fzf)" ; exit;;
	"limpiar debs de cache") sudo apt-get clean ; exit;;
	"limpiar cache") sudo apt-get autoclean ; exit;;
	"comprobar") sudo apt-get check ; exit;;
	"eliminar paquete debian instalado localmente") lista="$(apt list --installed 2>/dev/null | grep ', local'| cut -d'/' -f1 | fzf -m)" \
		&& echo "$lista" && for i in "$lista";do
			sudo dpkg -r $i
		done	; exit;;
	"purgar paquetes debian instalados localmente") lista="$(apt list --installed 2>/dev/null | grep ', local'| cut -d'/' -f1 | fzf -m)" \
		&& sudo dpkg -P $lista ; exit;;
	"listar paquetes debian instalados localmente") apt list --installed 2>/dev/null | grep ', local' ; exit;;
	"purgar paquetes") purga=$(dpkg --get-selections | awk '/deinstall/ {print $1}') \
		&& echo $purga && [ "$(echo 's\nn' | dmenu -p 'quieres purgar? ' )" = 's' ] \
		&& sudo apt purge $purga && exit || exit;;
	"instalar deb forzando") dpkg --force-architecture -i $(find . -maxdepth 1 | fzf) ;; #forzar instalacion con arquitectura ajena
	"reinstalar paquete") printf "paquete a reinstalar: " && read -r pac \
		&& sudo apt-get install --reinstall $pac ;;
	"ver versiones disponibles de un paquete") apt-cache madison ;; 
	"instalar paquete deb") archivo="$(find . -maxdepth 1 | fzf)" && dpkg -I "$archivo" && [ "$(printf 's\nn' | dmenu -p 'queres instalalo? ' )" = 's' ] \
	&& (sudo dpkg -i "$archivo" || sudo apt-get install -f) ;;
esac && exit

case $1 in
	-i) sudo apt install $1 ;;
	-u) sudo apt autoremove $1 ;;
esac

#apt-cache policy | sed -n 's/.*o=\([^,]\+\).*/\1/p' | uniq
