#!/bin/sh

token=$(cat $XDG_CONFIG_HOME/apis/nasa)
[ -z "$token" ] && token=DEMO_KEY
downdir=/tmp/nasa
app=wget
#app=curl

while [ -n "$1" ]; do
        case "$1" in
        -h|--help) printf '%s' "-c para obtener imágenes de la curiosity, -o de la opportunity, -s de la spirit" ;;
        -c)
                #param="$2"
                printf '%s' "pon fecha con formato americano (año-mes-día): " && read -r fecha
                a=$(curl -4 -sf "https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=$fecha&api_key=$token" | jq ".photos[].img_src")
                printf '%s' "$a" | while read -r line
                do
                        wget "$(printf '%s\n' "$line" | tr -d '"')" -P $downdir
                done
                shift
                ;;
        -o)
                a=$(curl -sf "https://api.nasa.gov/mars-photos/api/v1/rovers/opportunity/photos?sol=1000&api_key=$token" | jq ".photos[].img_src")
                printf '%s' "$a" | while read -r line
                do
                        wget "$(printf '%s\n' "$line" | tr -d '"')" -P $downdir
                done
                shift
                ;;
         -s)
                a=$(curl -sf "https://api.nasa.gov/mars-photos/api/v1/rovers/spirit/photos?sol=1000&api_key=$token" | jq ".photos[].img_src")
                printf '%s' "$a" | while read -r line
                do
                        wget "$(printf '%s\n' "$line" | tr -d '"')" -P $downdir
                done
                shift
                ;;
        *) printf '%s' "-c para obtener imágenes de la curiosity, -o de la opportunity, -s de la spirit" ;;
        esac
        shift
done

# obtener imagen del dia de nuestro vecindario cósmico
# put your api key instead of DEMO_KEY, this works as illustration (pon tu clave de api)
wget "$(curl -4 -sf "https://api.nasa.gov/planetary/apod?api_key=$token" |jq ".url"| tr -d '"')"
